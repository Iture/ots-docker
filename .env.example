# =============================================================================
# OpenTAKServer Docker Compose Configuration
# =============================================================================
# Copy this file to .env and customize as needed
# Documentation: See CLAUDE.md for detailed usage
# Last Updated: 2025-12-15

# =============================================================================
# 1. CONTAINER IMAGE VERSIONS
# =============================================================================
# Control which container versions to deploy
# Pin versions in production to prevent unexpected updates
# Run "docker-compose ps --format table {{.Service}}\t{{.Image}}" to see current versions

# OTS main server image
OTS_IMAGE_TAG=latest

# OTS web UI image
OTS_WEBUI_IMAGE_TAG=latest

# RabbitMQ message broker image
RABBITMQ_IMAGE_TAG=latest

# MediaMTX video streaming image (if enabled)
MEDIAMTX_IMAGE_TAG=1.13.0-ffmpeg

# Traefik reverse proxy image (only used with compose.traefik.yaml)
TRAEFIK_IMAGE_TAG=v3.5

# Nginx base image (used by persistent/nginx/Dockerfile)
NGINX_BASE_IMAGE_TAG=mainline-bookworm

# PostgreSQL base image (used by persistent/db/Dockerfile)
POSTGRES_BASE_IMAGE_TAG=18-trixie

# =============================================================================
# 2. DATA LOCATION CONFIGURATION
# =============================================================================
# Customize persistent data storage paths
# Use absolute paths or relative paths from compose.yaml location
# Create directories with correct permissions before first start

# OTS application data (config, CA, logs, uploads)
OTS_DATA_PATH=./persistent/ots

# Certificate Authority (subset of OTS_DATA_PATH, mounted read-only in nginx)
OTS_CA_PATH=./persistent/ots/ca

# PostgreSQL database storage (use fast SSD for production)
DB_DATA_PATH=./persistent/db

# RabbitMQ configuration files
RABBITMQ_CONFIG_PATH=./persistent/rabbitmq

# RabbitMQ data directory (optional, uncomment to enable persistence)
# Uncomment to persist RabbitMQ message queue data across restarts
#RABBITMQ_DATA_PATH=./persistent/rabbitmq/data

# Nginx templates and configuration
NGINX_TEMPLATES_PATH=./persistent/nginx/templates

# MediaMTX video streaming configuration
MEDIAMTX_CONFIG_PATH=./persistent/ots/mediamtx

# Traefik configuration (only used with compose.traefik.yaml)
TRAEFIK_CONFIG_PATH=./persistent/traefik

# =============================================================================
# 3. SYSTEM CONFIGURATION
# =============================================================================
# User and Group IDs for container permissions

# User ID (run "id -u" to find yours)
# Set to match your system user to avoid permission issues
# Default 0 (root) - not recommended for production
UID=1000

# Group ID (run "id -g" to find yours)
# Set to match your system group
# Default 0 (root) - not recommended for production
GID=1000

# PostgreSQL password (CHANGE IN PRODUCTION!)
# Used for ots user in database
POSTGRESQL_PASSWORD=POSTGRESQL_PASSWORD

# Proxy domain for Traefik routing (only used with compose.traefik.yaml)
# Set to your domain name (e.g., ots.example.com)
PROXY_DOMAIN=localhost

# =============================================================================
# 4. DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL and database settings

# Database connection string (usually auto-configured)
# Format: postgresql+psycopg://user:password@host/database
# Only override if using external database
#DOCKER_SQLALCHEMY_DATABASE_URI=postgresql+psycopg://ots:PASSWORD@ots-db/ots

# Enable SQL query logging (debug only, has performance impact)
#DOCKER_SQLALCHEMY_ECHO=False

# =============================================================================
# 5. OPENTAKSERVER CORE CONFIGURATION
# =============================================================================
# All OTS parameters require DOCKER_ prefix to be recognized
# See OpenTAKServer documentation: https://docs.opentakserver.io/configuration.html

## Network & Ports

# API listens on this address (loopback interface for local access)
#DOCKER_OTS_LISTENER_ADDRESS=127.0.0.1

# API listens on this port
#DOCKER_OTS_LISTENER_PORT=8081

# HTTP port for Marti API requests
#DOCKER_OTS_MARTI_HTTP_PORT=8080

# HTTPS port for Marti API requests
#DOCKER_OTS_MARTI_HTTPS_PORT=8443

# Enable TCP streaming port (default true)
#DOCKER_OTS_ENABLE_TCP_STREAMING_PORT=True

# TCP streaming port (unencrypted CoT messages)
#DOCKER_OTS_TCP_STREAMING_PORT=8088

# SSL streaming port (encrypted CoT messages)
#DOCKER_OTS_SSL_STREAMING_PORT=8089

## Security

# Flask secret key (auto-generated if not set)
# Change this in production for security!
#DOCKER_SECRET_KEY=

# Flask debug mode (NEVER enable in production!)
#DOCKER_DEBUG=False

# SSL certificate verification mode
# 0=CERT_NONE (no verification), 1=CERT_OPTIONAL, 2=CERT_REQUIRED (recommended)
#DOCKER_OTS_SSL_VERIFICATION_MODE=2

# Unique node identifier (auto-generated if not set)
#DOCKER_OTS_NODE_ID=

## Certificate Authority

# Name for your certificate authority
#DOCKER_OTS_CA_NAME=OpenTAKServer-CA

# Password for all generated certificates (CHANGE IN PRODUCTION!)
#DOCKER_OTS_CA_PASSWORD=atakatak

# Certificate validity period in days (default: 10 years)
#DOCKER_OTS_CA_EXPIRATION_TIME=3650

# CA certificate details (used for certificate signing)
#DOCKER_OTS_CA_COUNTRY=WW
#DOCKER_OTS_CA_STATE=XX
#DOCKER_OTS_CA_CITY=YY
#DOCKER_OTS_CA_ORGANIZATION=ZZ
#DOCKER_OTS_CA_ORGANIZATIONAL_UNIT=OpenTAKServer

## RabbitMQ Message Broker

# RabbitMQ server address
#DOCKER_OTS_RABBITMQ_SERVER_ADDRESS=127.0.0.1

# RabbitMQ authentication username
#DOCKER_OTS_RABBITMQ_USERNAME=guest

# RabbitMQ authentication password
#DOCKER_OTS_RABBITMQ_PASSWORD=guest

# Message time-to-live in milliseconds (default: 1 day)
#DOCKER_OTS_RABBITMQ_TTL=86400000

# Message prefetch count (default: 2)
#DOCKER_OTS_RABBITMQ_PREFETCH=2

## MediaMTX Video Streaming

# Enable video streaming service
#DOCKER_OTS_MEDIAMTX_ENABLE=True

# MediaMTX API endpoint
#DOCKER_OTS_MEDIAMTX_API_ADDRESS=http://localhost:9997

# MediaMTX API authentication token (auto-generated if not set)
#DOCKER_OTS_MEDIAMTX_TOKEN=

## Data Management

# Number of backup files to retain
#DOCKER_OTS_BACKUP_COUNT=7

# Enable channel functionality
#DOCKER_OTS_ENABLE_CHANNELS=True

# Delete old data after this period (0 = disabled)
# Set one or more of these to enable automatic data cleanup
#DOCKER_OTS_DELETE_OLD_DATA_SECONDS=0
#DOCKER_OTS_DELETE_OLD_DATA_MINUTES=0
#DOCKER_OTS_DELETE_OLD_DATA_HOURS=0
#DOCKER_OTS_DELETE_OLD_DATA_DAYS=0
#DOCKER_OTS_DELETE_OLD_DATA_WEEKS=1

## Processing

# Number of CoT parser worker processes
#DOCKER_OTS_COT_PARSER_PROCESSES=1

## Logging

# Log rotation schedule (midnight, W0-W6, or interval)
#DOCKER_OTS_LOG_ROTATE_WHEN=midnight

# Log rotation interval
#DOCKER_OTS_LOG_ROTATE_INTERVAL=0

# =============================================================================
# 6. OPENTAKSERVER OPTIONAL FEATURES
# =============================================================================

## Email Configuration

# Enable email features (user registration, password reset)
#DOCKER_OTS_ENABLE_EMAIL=False

# SMTP server address
#DOCKER_MAIL_SERVER=smtp.gmail.com

# SMTP server port
#DOCKER_MAIL_PORT=587

# Use SSL for SMTP connection
#DOCKER_MAIL_USE_SSL=False

# Use TLS for SMTP connection
#DOCKER_MAIL_USE_TLS=True

# SMTP authentication username
#DOCKER_MAIL_USERNAME=

# SMTP authentication password
#DOCKER_MAIL_PASSWORD=

# Default sender email address
#DOCKER_MAIL_DEFAULT_SENDER=

# Email domain filtering (whitelist/blacklist)
#DOCKER_OTS_EMAIL_DOMAIN_WHITELIST=[]
#DOCKER_OTS_EMAIL_DOMAIN_BLACKLIST=[]
#DOCKER_OTS_EMAIL_TLD_WHITELIST=[]
#DOCKER_OTS_EMAIL_TLD_BLACKLIST=[]

## LDAP Authentication

# Enable LDAP for user and group administration
#DOCKER_OTS_ENABLE_LDAP=False

# LDAP server address
#DOCKER_LDAP_HOST=127.0.0.1

# LDAP base DN (distinguished name)
#DOCKER_LDAP_BASE_DN=

# LDAP user DN (distinguished name for users)
#DOCKER_LDAP_USER_DN=

# LDAP group DN (distinguished name for groups)
#DOCKER_LDAP_GROUP_DN=

# LDAP bind user DN (admin account for queries)
#DOCKER_LDAP_BIND_USER_DN=cn=admin,ou=users=dc=example,dc=com

# LDAP bind user password
#DOCKER_LDAP_BIND_USER_PASSWORD=password

# LDAP attribute mappings
#DOCKER_OTS_LDAP_ADMIN_GROUP=ots_admin
#DOCKER_OTS_LDAP_COLOR_ATTRIBUTE=colorAttribute
#DOCKER_OTS_LDAP_ROLE_ATTRIBUTE=roleAttribute
#DOCKER_OTS_LDAP_CALLSIGN_ATTRIBUTE=callsignAttribute
#DOCKER_OTS_LDAP_PREFERENCE_ATTRIBUTE_PREFIX=ots_
#DOCKER_OTS_LDAP_GROUP_PREFIX=ots_

## ADS-B Aircraft Tracking

# Center coordinates for aircraft tracking (default: Manhattan)
# Latitude for center of tracking area
#DOCKER_OTS_AIRPLANES_LIVE_LAT=40.744213

# Longitude for center of tracking area
#DOCKER_OTS_AIRPLANES_LIVE_LON=-73.986939

# Tracking radius in kilometers
#DOCKER_OTS_AIRPLANES_LIVE_RADIUS=10

# Group name for ADS-B data in OTS
#DOCKER_OTS_ADSB_GROUP=ADS-B

## AIS Maritime Tracking

# AISHub.net username for marine vessel tracking
#DOCKER_OTS_AISHUB_USERNAME=

# Bounding box south latitude
#DOCKER_OTS_AISHUB_SOUTH_LAT=

# Bounding box west longitude
#DOCKER_OTS_AISHUB_WEST_LON=

# Bounding box north latitude
#DOCKER_OTS_AISHUB_NORTH_LAT=

# Bounding box east longitude
#DOCKER_OTS_AISHUB_EAST_LON=

# Filter by MMSI numbers (comma-separated)
#DOCKER_OTS_AISHUB_MMSI_LIST=

# Filter by IMO numbers (comma-separated)
#DOCKER_OTS_AISHUB_IMO_LIST=

# Group name for AIS data in OTS
#DOCKER_OTS_AIS_GROUP=AIS

## Meshtastic Integration

# Enable Meshtastic devices via MQTT
#DOCKER_OTS_ENABLE_MESHTASTIC=False

# MQTT publish topic for Meshtastic messages
#DOCKER_OTS_MESHTASTIC_TOPIC=opentakserver

# Publish interval in seconds
#DOCKER_OTS_MESHTASTIC_PUBLISH_INTERVAL=30

# Node info update interval in seconds
#DOCKER_OTS_MESHTASTIC_NODEINFO_INTERVAL=3

# Enabled downlink channels (comma-separated list)
#DOCKER_OTS_MESHTASTIC_DOWNLINK_CHANNELS=[]

# Group name for Meshtastic data in OTS
#DOCKER_OTS_MESHTASTIC_GROUP=Meshtastic

## Mumble Voice Integration

# Enable Mumble server authentication
#DOCKER_OTS_ENABLE_MUMBLE_AUTHENTICATION=False

## TAK.gov Integration

# Link OpenTAKServer account with TAK.gov
#DOCKER_OTS_TAK_GOV_LINKED=False

# TAK.gov OAuth access token
#DOCKER_OTS_TAK_GOV_ACCESS_TOKEN=

# TAK.gov OAuth refresh token
#DOCKER_OTS_TAK_GOV_REFRESH_TOKEN=

# =============================================================================
# 7. ADVANCED CONFIGURATION
# =============================================================================

## Plugins

# Enable server plugins
#DOCKER_OTS_ENABLE_PLUGINS=True

# Plugin repository URL
#DOCKER_OTS_PLUGIN_REPO=https://repo.opentakserver.io/brian/prod/

# Valid plugin name prefixes (JSON array)
#DOCKER_OTS_PLUGIN_PREFIXES=["ots-", "ots_"]

## Security

# IP whitelist for API access (JSON array)
# Add IP addresses to restrict access
#DOCKER_OTS_IP_WHITELIST=["127.0.0.1"]

## Features

# Enable profile map sources
#DOCKER_OTS_PROFILE_MAP_SOURCES=True

## Flask-Security Authentication Settings (Advanced)

# Minimum password length
#DOCKER_SECURITY_PASSWORD_LENGTH_MIN=8

# Enable two-factor authentication
#DOCKER_SECURITY_TWO_FACTOR=True

# Minimum username length
#DOCKER_SECURITY_USERNAME_MIN_LENGTH=1

# =============================================================================
# USAGE EXAMPLES
# =============================================================================

# Example 1: Production setup with pinned versions and external SSD database
#OTS_IMAGE_TAG=v1.7.0
#OTS_WEBUI_IMAGE_TAG=v1.5.0
#RABBITMQ_IMAGE_TAG=3.13-management
#DB_DATA_PATH=/mnt/fast-ssd/ots-database
#POSTGRESQL_PASSWORD=secure-password-here
#DOCKER_OTS_CA_NAME=YourOrganization-CA
#DOCKER_OTS_CA_PASSWORD=secure-ca-password

# Example 2: Development setup with debug mode and custom CA
#DOCKER_DEBUG=True
#DOCKER_OTS_CA_NAME=MyLab-CA
#DOCKER_OTS_MEDIAMTX_ENABLE=False

# Example 3: LDAP integration
#DOCKER_OTS_ENABLE_LDAP=True
#DOCKER_LDAP_HOST=ldap.example.com
#DOCKER_LDAP_BASE_DN=dc=example,dc=com
#DOCKER_LDAP_USER_DN=ou=users,dc=example,dc=com
#DOCKER_LDAP_BIND_USER_DN=cn=admin,dc=example,dc=com
#DOCKER_LDAP_BIND_USER_PASSWORD=ldap-admin-password

# =============================================================================
# NOTES
# =============================================================================
# - Copy this file to .env and customize
# - Environment variables override defaults in compose.yaml
# - Use docker-compose config to validate and preview resolved configuration
# - For detailed parameter descriptions, see CLAUDE.md
# - Consult OpenTAKServer official docs for advanced configurations
# - Never commit .env file (it's in .gitignore)
# - Test configuration changes in staging before production
